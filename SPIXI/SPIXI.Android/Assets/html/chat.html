<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>IXIAN</title>
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/spixiui.css">

    <link rel="stylesheet" type="text/css" href="libs/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" type="text/css" href="libs/fontawesome/css/solid.min.css">

    <script src="libs/twemoji/twemoji.min.js"></script>
    
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.touchSwipe.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/qrcode.min.js"></script>
    <script src="js/spixi.js"></script>
    

    
    <link href="css/jquery.lsxemojipicker.css" rel="stylesheet">
	<script src="js/jquery.lsxemojipicker.js"></script>
    
</head>
<body onload="onload()">
    <div id="wrap" class="container-fluid noselect">

        <!-- Toolbar Chat -->
        <div class="spixi-toolbar shadow">
            <div class="spixi-toolbar-line"></div>
            <div class="row spixi-toolbar-row" style="padding-top: 0px;">
                <div id="backbtn" class="col-2 spixi-center" style="padding-top: 10px;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="col-8">
                    <div id="title" class="spixi-toolbar-chat-name"></div>
                    <div id="status" class="spixi-toolbar-chat-status"></div>
                </div>
                <div id="phonebtn" class="col-2 spixi-center" style="padding-top: 10px;">
                    <i class="fas fa-phone"></i>
                </div>
            </div>

        </div>
        <div class="spixi-toolbar-holder"></div>
        <!-- End Toolbar -->
        <!-- DescriptionBar -->
        <div id="contactrequestbar" class="spixi-descriptionbar chat" style="display:none;">
            <div class="container">
                <div class="row spixi-descriptionbar-row">
                    <div class="col-2 spixi-center"><i class="fa fa-user-plus"></i></div>
                    <div class="col-10 spixi-descriptionbar-row-details">
                        <div id="contactrequesttitle">has sent a CONTACT REQUEST</div>
                        <div class="row" style="width: 300px; margin-top: 5px;">
                            <div class="col-6">
                                <div id="request_bar_accept" class="spixi-button small extrasmallwidth darkshadow blue">Accept</div>
                            </div>
                            <div class="col-6">
                                <div id="request_bar_ignore" class="spixi-button small extrasmallwidth darkshadow ghost">Ignore</div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <!-- End DescriptionBar -->

        <div id="messages">
            <div class="spixi-holder-20"></div>
        </div>

        <div id="chatholder" class="chatholder"></div>
        <div id="chatbar">
            <div class="chatbar-container">
                <div id="chat_attach">
                    <i class="fa fa-plus-circle"></i>
                </div>
                <div id="chat_emoji">
                    <i class="fa fa-smile-wink"></i>
                </div>

                <input type="text" id="chat_input" onkeyup="" placeholder="Type your message..." />
                <div class="chatbar-sendbutton-wrapper"><div id="chat_send" class="chatbar-sendbutton"><i class="fa fa-paper-plane"></i></div></div>
            </div>
        </div>
        <div id="chatattachbar">
            <div class="row ">
                <div class="col-4 chat_attach_tab" id="ca_sendfile">
                    <i class="fa fa-file-alt chatattachsymbol"></i><br />
                    Send File
                </div>
                <div class="col-4 chat_attach_tab" id="ca_request">
                    <i class="fa fa-angle-double-down chatattachsymbol"></i><br />
                    Request Payment
                </div>
                <div class="col-4 chat_attach_tab" id="ca_send">
                    <i class="fa fa-angle-double-up chatattachsymbol"></i><br />
                    Send Payment
                </div>
            </div>
        </div>

    </div>
    
    
<script type="text/javascript">
    var attachMode = false;

    var contactrequestbar = document.getElementById("contactrequestbar");
    
    document.getElementById("backbtn").onclick = function() {
        location.href = "ixian:back";
    }
    
    document.getElementById("phonebtn").onclick = function() {
        location.href = "ixian:call";
    }    
    
    function test() {
            setNickname("TesterTesterTesterTesterTesterTesterTesterTesterTesterTesterTesterTester");
            //showContactRequest(true);
            addMe(0, "img/spixiavatar.png", "Hi!", "11:23 AM");
            addFile(10, "img/spixiavatar.png", "file1.png", "10:23 AM", false, false, false);
        
            setTimeout(function () { addMe(1, "img/spixiavatar.png", "How are you today? &#x1f602", "11:23 AM", "True", "True"); }, 1000);
            setTimeout(function () { addThem(2, "img/spixiavatar.png", "Hey! &#x1f604", "11:24 AM", "True", "True"); }, 1300);
            setTimeout(function () { addThem(3, "img/spixiavatar.png", "Great, thanks for asking.", "11:24 AM", "True", "True"); }, 1600);
            setTimeout(function () { addThem(4, "img/spixiavatar.png", "And how are you?", "11:24 AM", "True", "True"); }, 1900);
            setTimeout(function () { addFile(12, "", "file.png", "10:27 AM", true, true,true); }, 2200);        
            setTimeout(function () { addMe(5, "", "Great! Just got back from the moon.", "11:24 AM", "True", "True"); }, 2200);
            setTimeout(function () { addThem(6, "img/spixiavatar.png", "Ohh??? What were you doing there?", "11:25 AM", "True", "True"); }, 2500);
            setTimeout(function () { addMe(7, "", "Was building my own Luna Park...", "11:25 AM", "True", "False"); }, 3000);
            setTimeout(function () { addMe(8, "", "html<div>injection</div>test", "11:25 AM", "False", "False"); }, 4000);               
    }
    
    
    document.getElementById("ca_request").onclick = function () {
        location.href = "ixian:request";
    } 
    document.getElementById("ca_send").onclick = function () {
        location.href = "ixian:send";
    }

    document.getElementById("ca_sendfile").onclick = function () {
        location.href = "ixian:sendfile";
    }
    
    document.getElementById("request_bar_ignore").onclick = function () {
        location.href = "ixian:back";
    } 
    document.getElementById("request_bar_accept").onclick = function () {
        showContactRequest(false);
        location.href = "ixian:accept";
    }
    function showContactRequest(show) {
        if(show == true)
        {
            contactrequestbar.style.display = "block";
            document.getElementById("chat_input").disabled = true;
        }
        else 
        {
            contactrequestbar.style.display = "none";
            document.getElementById("chat_input").disabled = false;
        }
    }
    
    document.getElementById("chat_send").onclick = function () {
        document.getElementById("chat_input").click();
        document.getElementById("chat_input").focus();
        var chat_text = document.getElementById("chat_input").value;

        if (chat_text.length > 0)
            location.href = "ixian:chat:" + encodeURIComponent(chat_text);
    }

    $("#chat_input").keyup(function (event) {
        if (event.keyCode === 13) {
            $("#chat_send").click();
        }
    
        var chat_text = document.getElementById("chat_input").value;
        if(chat_text.length > 0)        
            document.getElementById("chat_send").style.backgroundColor = "#C1185B";
        else 
            document.getElementById("chat_send").style.backgroundColor = "#BABABA";
        
    });

    function clearInput() {
        document.getElementById("chat_input").value = "";
        document.getElementById("chat_send").style.backgroundColor = "#BABABA";
    }
    
    function addText(id, avatar, text, time, className) {
            var textEl = document.createElement('div');
            textEl.className = "text";
            textEl.innerHTML = text;

            twemoji.parse(textEl);

            var timeEl = document.createElement('div');
            timeEl.className = "time";
            timeEl.innerHTML = time + " <i class=\"statusIndicator fas fa-check\"></i>";


            var bubbleEl = document.createElement('div');
            bubbleEl.id = "msg_" + id;
            bubbleEl.className = className + "";
            bubbleEl.appendChild(textEl);
            bubbleEl.appendChild(timeEl);

            if (avatar != "") {
                var avatarEl = document.createElement('img');
                avatarEl.className = "avatar";
                avatarEl.src = avatar;
                bubbleEl.appendChild(avatarEl);
            }

            document.getElementById("messages").appendChild(bubbleEl);
            //window.scrollTo(0, document.body.scrollHeight);             
            bubbleEl.scrollIntoView(true);
    }

    function addMe(id, avatar, text, time, sent, read) {    
        var additionalClasses = "";
        if (sent == "True") {
            additionalClasses = " sent";
        }
        if (read == "True") {
            additionalClasses += " read";
        }
        addText(id, avatar, text, time, "spixi-bubble myself" + additionalClasses);
    }

    function addThem(id, avatar, text, time) {
        addText(id, avatar, text, time, "spixi-bubble");
    }
    
    function addFile(id, avatar, name, time, me, sent, read) {
        var additionalClasses = "";
        if (sent == true) {
            additionalClasses = " sent";
        }
        if (read == true) {
            additionalClasses += " read";
        }
        
        var textEl = document.createElement('div');
        textEl.className = "text";
        textEl.innerHTML = name;

        var timeEl = document.createElement('div');
        timeEl.className = "time";
        timeEl.innerHTML = time + " <i class=\"statusIndicator fas fa-check\"></i>";


        var bubbleEl = document.createElement('div');
        bubbleEl.id = "msg_" + id;
        bubbleEl.className = "spixi-bubble file" + additionalClasses;
        if(me == true)
            bubbleEl.className = bubbleEl.className + " myself";
        
        bubbleEl.appendChild(textEl);
        bubbleEl.appendChild(timeEl);

        if (avatar != "") {
            var avatarEl = document.createElement('img');
            avatarEl.className = "avatar";
            avatarEl.src = avatar;
            bubbleEl.appendChild(avatarEl);
        }
        
        var icon = document.createElement('div');
        icon.className = "fa fa-folder-open actionicon";
        bubbleEl.appendChild(icon);
        
        var linkEl = document.createElement('a');
        linkEl.href = "ixian:acceptfile:"+id;
        linkEl.appendChild(bubbleEl);
        
        document.getElementById("messages").appendChild(linkEl);         
        linkEl.scrollIntoView(true);
    }

    function updateMessage(id, message, sent, read) {
        var msgEl = document.getElementById("msg_" + id);
        if (msgEl != null) {

            var additionalClasses = "";
            if (sent == "True") {
                additionalClasses = " sent";
            }
            if (read == "True") {
                additionalClasses += " read";
            }

            msgEl.className = "spixi-bubble myself" + additionalClasses;

            var textEls = msgEl.getElementsByClassName("text");
            if (textEls.length > 0) {
                var textEl = textEls[0];
                textEl.innerHTML = message;

                twemoji.parse(textEl);
            }
        }
    }

    function addPaymentRequest(id, avatar, title, amount, status, statusIcon, time, localSender) {
        var message = "<div class=\"title\"><i class=\"fas fa-flag\"></i> " + title + "</div>";
        message += "<div class=\"status\">Status:<div class=\"content\">" + status + "<i class=\"fas "+statusIcon+"\"></i></div></div>";
        message += "<div class=\"amount\">Amount:<div class=\"content\"><div class=\"ixiCashIcon\"></div>" + amount + "</div></div>";
        if (!localSender) {
            message += "<div class=\"view\" onclick=\"location.href = 'ixian:confirmrequest:" + amount + "'\"><i class=\"fas fa-search\"></i> View</div>";
        }

        var additionalClasses = "";
        if (localSender == "True") {
            additionalClasses = " myself";
        }

        addText(id, avatar, message, time, "spixi-bubble spixi-payment-request" + additionalClasses);

        /*if (amount != "0") {
            message += "<br/><div class=\"spixi-button small smallwidth center\" onclick=\"location.href = 'ixian:confirmrequest:" + amount + "'\">View details</div>";
        } else {
            addText(id, "", message, time, "spixi-bubble myself spixi-payment-request");
        }*/
    }

    function setNickname(nick) {
        document.getElementById("title").innerHTML = nick;
        document.getElementById("contactrequesttitle").innerHTML = nick + " has sent a CONTACT REQUEST";
    }
    
    $('#chat_emoji').lsxEmojiPicker({
  twemoji: false,
  onSelect: function(emoji){
    console.log(emoji);
      document.getElementById("chat_input").value += emoji.value + " ";
  }
    });
    
    // Handle 'attach' bar, allowing to send and request IXI
    document.getElementById("chat_attach").onclick = function () {
        document.getElementById("chat_input").click();
        document.getElementById("chat_input").focus();
        if(attachMode == true)
        {
            document.getElementById("chat_attach").style = "background-image: url('./img/AttachFile_icon.png')";
            attachMode = false;
            hideAttach();
        }
        else 
        {
            document.getElementById("chat_attach").style = "background-image: url('./img/AttachFile_icon_active.png')";
            attachMode = true;
            showAttach();
        }    
    }
    
    function hideAttach()
    {
        document.getElementById("chatbar").style.bottom = "0px";
        document.getElementById("chatholder").style.height = "57px";
        document.getElementById("chatattachbar").style.bottom = "-60px";              
    }
            
    function showAttach()
    {
        document.getElementById("chatbar").style.bottom = "60px";
        document.getElementById("chatholder").style.height = "102px";
        document.getElementById("chatattachbar").style.bottom = "0px";        
    }

    function showIndicator(ind) {
        if (ind == "true") {
            document.getElementById("status").innerHTML = "online";
        } else {
            document.getElementById("status").innerHTML = "offline";
        }
    }
</script>
</body>
</html>